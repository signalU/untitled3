/**
 * Created by diego on 12/5/16.
 */


Template.SAT.onCreated(function () {

        this.propositionsByType = new ReactiveVar([]);
        this.onlyPredecessors = new ReactiveVar([]);
        this.final = new ReactiveVar([]);
        this.finalSelected = new ReactiveVar([]);
        this.rules = new ReactiveVar([]);
        this.conclusions = new ReactiveVar([]);
        this.inconclusions = new ReactiveVar([]);
        var self = this;
});

Template.SAT.events({
    'submit #formRecognizer': function (event, template) {
        event.preventDefault();
        console.log("loading");


        // var tt = "(((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))&-((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s)))))&((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))|((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s))))))"
        // var ttt = '(((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))&-((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s)))))&((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))|((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s))))))'
        // var tt2 = "-(((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))&-((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s)))))&((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))|((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s))))))"
        // var ttt2 = '-(((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))&-((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s)))))&((((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s))))))))|((((-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))|-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s)))))&-((p->(q->r))->((p|s)->((q|r)|s))))|-(-(((-p|q)->(p->q))&((p->q)->(-p|q)))&-(((p&q)|-(r&-s))->((p|(r->s))&(q|(r->s))))))|-((-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))|-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))&-((a->(b->r))->((a|s)->((b|r)|s))))|-(-(((-a|b)->(a->b))&((a->b)->(-a|b)))&-(((a&b)|-(r&-s))->((a|(r->s))&(b|(r->s)))))))|-((p->(q->r))->((p|s)->((q|r)|s))))))'
        // var ee = true
        // var isSatR
        //
        // var data = event.currentTarget.sentence.value;
        //
        // if(data == tt){
        //     //isSatR.append(["it is not satisfied"])
        //     isSatR = "[it is not satisfied]"
        //     ee = false
        // }
        //
        // if (data == tt2){
        //     ee = false
        //     isSatR = "[[its tautology], [it is satisfied]]"
        // }



        var sentence = {
            name: event.currentTarget.sentence.value,
        };
        // Sentences.insert(sentence);
        // Meteor.call('backwards', _id, function (error, data) {

        // if (ee == true){
            Meteor.call("SAT", event.currentTarget.sentence.value, function (error, data) {
                if(error){
                    Materialize.toast(error.reason, 2000, "red");
                }
                else{
                    Materialize.toast(data, 2000, "blue");
                    // $("#sentence").val("");
                    $("#sentence").focus();
                    console.log("DATA: ", data);
                    var tempArr = [];
                    tempArr.push({"data": data})
                    template.final.set(tempArr)
                }
            });
        // }
        // else{
        //     console.log("DATA: ", isSatR);
        //     var tempArr = [];
        //     tempArr.push({"data": isSatR})
        //     template.final.set(tempArr)

        // }


        // history.back();



    },
    'click #cancel': function (e) {
        e.preventDefault();
        history.back()
    },
    // 'click #addDefault': function (e) {
    //     e.preventDefault();
    //     Meteor.call("addDefaultRules");
    // }
});


Template.SAT.helpers({
    something: function () {
        //var value = Template.instance().final.get();
        //return value.data;
        var self = Template.instance();
        return self.final.get();
    }
})
